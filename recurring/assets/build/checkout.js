(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,r=window.wp.element,n=window.wp.apiFetch;var s=e.n(n);const c=window.wp.i18n;var o,i;document.getElementById("vipps-mobilepay-recurring-checkout")&&(o=document.querySelector("#vipps-mobilepay-recurring-checkout"),i=(0,t.createElement)((function(){const e=window.VippsRecurringCheckout,{continueShoppingUrl:n}=window.VippsMobilePaySettings,[o,i]=(0,r.useState)(null),a=(0,r.useRef)(null),u=(0,r.useRef)(null);(0,r.useEffect)((()=>{e.redirect_url&&(window.location.href=e.redirect_url)}),[e]);const l=(0,r.useCallback)((()=>{s()({path:"/vipps-mobilepay-recurring/v1/checkout/session",method:"GET"}).then((e=>{i(e)}))}),[]);(0,r.useEffect)((()=>{if(e.session.token&&e.success)return a.current=setInterval(l,2e4),()=>{clearInterval(a.current)}}),[e]),(0,r.useEffect)((()=>{o&&("EXPIRED"!==o.status?o.redirect_url&&(window.location.href=o.redirect_url):clearInterval(a.current))}),[o]);const p=(0,r.useCallback)((e=>{const t=u.current.getAttribute("src"),r=new URL(t).origin;e.origin===r&&("resize"===e.data.type&&(u.current.style.height=`${e.data.frameHeight}px`),"payment_url"===e.data.type&&(window.location.href=e.data.paymentUrl))}),[u.current]);return(0,r.useEffect)((()=>{if(u.current)return window.addEventListener("message",p),()=>{window.removeEventListener("message",p)}}),[u.current,e.session.token]),(0,t.createElement)("form",{id:"vippsdata",className:"woocommerce-checkout"},(0,t.createElement)("div",{className:"vipps-recurring-checkout-page"},!e.session.success&&e.session.msg?.length>0?(0,t.createElement)("div",{className:"vipps-recurring-checkout-page__error"},(0,t.createElement)("p",null,e.session.msg),(0,t.createElement)("p",null,(0,t.createElement)("a",{href:n,className:"btn button vipps-recurring-checkout-page__error__action"},(0,c.__)("Continue shopping","woo-vipps")))):(0,t.createElement)("div",{className:"vipps-recurring-checkout-page__loading"},"EXPIRED"!==o?.status&&(0,t.createElement)(t.Fragment,null,!e.session.token&&(0,t.createElement)("div",{className:"vipps-recurring-checkout-page__loading__spinner"}),e.session.token&&(0,t.createElement)("iframe",{ref:u,src:`${e.session.checkoutFrontendUrl||e.session.src}?token=${e.session.token}`,frameBorder:"0",width:"100%"})),"EXPIRED"===o?.status&&(0,t.createElement)("div",null,(0,c.__)("Checkout session expired. Please refresh to start a new session.","woo-vipps")))))}),null),r.createRoot?(0,r.createRoot)(o).render(i):(0,r.render)(i,o))})();