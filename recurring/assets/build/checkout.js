(()=>{"use strict";var e={n:r=>{var t=r&&r.__esModule?()=>r.default:()=>r;return e.d(t,{a:t}),t},d:(r,t)=>{for(var n in t)e.o(t,n)&&!e.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:t[n]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r)};const r=window.React,t=window.wp.element,n=window.wp.apiFetch;var s=e.n(n);const c=window.wp.i18n;var o,a;document.getElementById("vipps-mobilepay-recurring-checkout")&&(o=document.querySelector("#vipps-mobilepay-recurring-checkout"),a=(0,r.createElement)((function(){const e=window.VippsRecurringCheckout,{continueShoppingUrl:n}=window.VippsMobilePaySettings,[o,a]=(0,t.useState)(null),i=(0,t.useRef)(null),u=(0,t.useRef)(null);(0,t.useEffect)((()=>{e.redirect_url&&(window.location.href=e.redirect_url)}),[e]);const l=(0,t.useCallback)((()=>{s()({path:"/vipps-mobilepay-recurring/v1/checkout/session",method:"GET"}).then((e=>{a(e)}))}),[]);(0,t.useEffect)((()=>{if(e.session.token&&e.success)return i.current=setInterval(l,2e4),()=>{clearInterval(i.current)}}),[e]),(0,t.useEffect)((()=>{o&&("EXPIRED"!==o.status?o.redirect_url&&(window.location.href=o.redirect_url):clearInterval(i.current))}),[o]);const p=(0,t.useCallback)((e=>{const r=u.current.getAttribute("src"),t=new URL(r).origin;e.origin===t&&("resize"===e.data.type&&(u.current.style.height=`${e.data.frameHeight}px`),"payment_url"===e.data.type&&(window.location.href=e.data.paymentUrl))}),[u.current]);return(0,t.useEffect)((()=>{if(u.current)return window.addEventListener("message",p),()=>{window.removeEventListener("message",p)}}),[u.current,e.session.token]),(0,r.createElement)("form",{id:"vippsdata",className:"woocommerce-checkout"},(0,r.createElement)("div",{className:"vipps-recurring-checkout-page"},!e.session.success&&e.session.msg?.length>0?(0,r.createElement)("div",{className:"vipps-recurring-checkout-page__error"},(0,r.createElement)("p",null,e.session.msg),(0,r.createElement)("p",null,(0,r.createElement)("a",{href:n,className:"btn button vipps-recurring-checkout-page__error__action"},(0,c.__)("Continue shopping","vipps-recurring-payments-gateway-for-woocommerce")))):(0,r.createElement)("div",{className:"vipps-recurring-checkout-page__loading"},"EXPIRED"!==o?.status&&(0,r.createElement)(r.Fragment,null,!e.session.token&&(0,r.createElement)("div",{className:"vipps-recurring-checkout-page__loading__spinner"}),e.session.token&&(0,r.createElement)("iframe",{ref:u,src:`${e.session.checkoutFrontendUrl||e.session.src}?token=${e.session.token}`,frameBorder:"0",width:"100%"})),"EXPIRED"===o?.status&&(0,r.createElement)("div",null,(0,c.__)("Checkout session expired. Please refresh to start a new session.","vipps-recurring-payments-gateway-for-woocommerce")))))}),null),t.createRoot?(0,t.createRoot)(o).render(a):(0,t.render)(a,o))})();