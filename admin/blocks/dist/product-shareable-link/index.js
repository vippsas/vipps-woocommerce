(()=>{"use strict";var e={20:(e,t,i)=>{var r=i(609),a=Symbol.for("react.element"),o=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),n=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,i){var r,l={},p=null,c=null;for(r in void 0!==i&&(p=""+i),void 0!==t.key&&(p=""+t.key),void 0!==t.ref&&(c=t.ref),t)o.call(t,r)&&!s.hasOwnProperty(r)&&(l[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===l[r]&&(l[r]=t[r]);return{$$typeof:a,type:e,key:p,ref:c,props:l,_owner:n.current}}t.jsx=l,t.jsxs=l},848:(e,t,i)=>{e.exports=i(20)},609:e=>{e.exports=window.React}},t={};function i(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,i),o.exports}(()=>{const e=window.wc.productEditor,t=window.wc.blockTemplates,r=window.wc.components,a=window.wp.components,o=window.wp.i18n;var n=i(609),s=i(848);const l=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"woo-vipps/product-shareable-link","version":"0.1.0","title":"Blocks","category":"widgets","icon":"flag","description":"A block that handles Vipps MobilePay shareable links for the new WooCommerce product editor.","attributes":{"message":{"type":"string","__experimentalRole":"content","source":"text","selector":"div"},"title":{"type":"string"}},"supports":{"html":false,"inserter":false},"textdomain":"woo-vipps","editorScript":"file:./index.js","editorStyle":"file:./index.css","style":"file:./index.css"}');(0,e.registerProductEditorBlockType)({metadata:l,settings:{edit:function({attributes:i}){const[l=[]]=(0,e.__experimentalUseProductEntityProp)("variations"),p=["",...l],c=l.length>0,[d]=(0,e.__experimentalUseProductEntityProp)("id"),u=(0,t.useWooBlockProps)(i),[_=[],v]=(0,e.__experimentalUseProductEntityProp)("meta_data"),[y]=(0,e.__experimentalUseProductEntityProp)("vipps_share_link_nonce"),k=_.filter((e=>e.key.startsWith("_vipps_shareable_links")&&void 0!==e.value)),[w,h]=(0,n.useState)(null),[m,b]=(0,n.useState)(null),[f,x]=(0,n.useState)(!1);return(0,s.jsxs)("div",{...u,children:[(0,s.jsx)("span",{children:i.title}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"create-link-section",children:[c&&(0,s.jsx)(a.SelectControl,{className:"vipps-sharelink-variant",value:m?.toString(),onChange:e=>{var t;return b(null!==(t=parseInt(e,10))&&void 0!==t?t:null)},label:(0,o.__)("Variation","woo-vipps"),options:p.map((e=>({label:e.toString(),value:e.toString()})))}),(0,s.jsxs)(a.Button,{variant:"secondary",disabled:f,type:"button",onClick:async function(){try{x(!0);const e=new URLSearchParams({action:"vipps_generate_unused_shareable_meta_key",vipps_share_shareable_link_nonce:y,prodid:d,varid:m?.toString()||"0"}),t=await fetch(window.ajaxurl,{method:"POST",body:e.toString(),credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}});if(!t.ok)throw new Error;const i=await t.json();if(!i.ok)throw new Error(i.msg);v([..._,{key:"_vipps_shareable_links",value:{product_id:d,variation_id:i.variation_id,key:i.key,url:i.url,variant:i.variant},id:-1},{key:"_vipps_shareable_link_"+i.key,value:{product_id:d,variation_id:i.variation_id,key:i.key},id:-1}])}catch(e){e instanceof Error&&alert((0,o.__)("Error creating shareable link.","woo-vipps")+e.message)}finally{x(!1)}},children:[f&&(0,s.jsx)(a.Spinner,{}),(0,o.__)("Create shareable link","woo-vipps")]})]}),(0,s.jsx)(r.Table,{headers:[{key:"variant",label:(0,o.__)("Variation","woo-vipps"),visible:c},{key:"link",label:(0,o.__)("Link","woo-vipps")},{key:"actions",label:(0,o.__)("Actions","woo-vipps"),cellClassName:"table-actions-col"}].filter((e=>!1!==e.visible)),rows:k.map((e=>[{key:"variant",display:e.value.variant,visible:c},{key:"link",display:(0,s.jsx)(a.Button,{href:e.value.url,variant:"link",target:"_blank",children:e.value.url})},{key:"actions",display:(0,s.jsxs)("div",{children:[(0,s.jsx)(a.Button,{disabled:null!==w,onClick:()=>async function(e){if(h(e),navigator.clipboard)navigator.clipboard.writeText(e);else{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}await new Promise((e=>setTimeout(e,2500))),h(null)}(e.value.url),children:w===e.value.url?(0,o.__)("Copied!","woo-vipps"):(0,o.__)("Copy","woo-vipps")}),(0,s.jsx)(a.Button,{onClick:()=>function(e){const t=_.map((t=>{const i=t.key.startsWith("_vipps_shareable_links")&&t.value?.key==e,r="_vipps_shareable_links"===t.key&&t?.value?.key==e;return i||r?{...t,value:void 0}:t}));v(t)}(e.value.key),children:(0,o.__)("Delete","woo-vipps")})]})}].filter((e=>!1!==e.visible))))})]}),(0,s.jsx)("p",{dangerouslySetInnerHTML:{__html:i.message}})]})}}})})()})();