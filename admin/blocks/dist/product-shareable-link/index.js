(()=>{"use strict";const e=window.wc.productEditor,t=window.React,a=window.wc.blockTemplates,n=window.wc.components,i=window.wp.components,o=window.wp.i18n,r=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"woo-vipps/product-shareable-link","version":"0.1.0","title":"Blocks","category":"widgets","icon":"flag","description":"A block that handles Vipps MobilePay shareable links for the new WooCommerce product editor.","attributes":{"message":{"type":"string","__experimentalRole":"content","source":"text","selector":"div"},"title":{"type":"string"}},"supports":{"html":false,"inserter":false},"textdomain":"woo-vipps","editorScript":"file:./index.js","editorStyle":"file:./index.css","style":"file:./index.css"}');(0,e.registerProductEditorBlockType)({metadata:r,settings:{edit:function({attributes:r}){const[l=[]]=(0,e.__experimentalUseProductEntityProp)("variations"),[s]=(0,e.__experimentalUseProductEntityProp)("id"),c=(0,a.useWooBlockProps)(r),[p=[],d]=(0,e.__experimentalUseProductEntityProp)("meta_data"),[u]=(0,e.__experimentalUseProductEntityProp)("share_link_nonce"),m=p.filter((e=>e.key.startsWith("_vipps_shareable_links"))),[v,w]=(0,t.useState)(null),[_,k]=(0,t.useState)(null),[y,h]=(0,t.useState)(!1);return(0,t.createElement)("div",{...c},(0,t.createElement)("span",null,r.title),(0,t.createElement)("div",null,(0,t.createElement)("div",{className:"create-link-section"},l.length>0&&(0,t.createElement)(i.SelectControl,{className:"vipps-sharelink-variant",value:_?.toString(),onChange:e=>k(parseInt(e,10)),label:(0,o.__)("Variation","woo-vipps"),options:l.map((e=>({label:e.toString(),value:e.toString()})))}),(0,t.createElement)(i.Button,{variant:"secondary",disabled:y,type:"button",onClick:async function(){try{h(!0);const e=new URLSearchParams({action:"vipps_create_shareable_link",vipps_share_sec:u,prodid:s,varid:_?.toString()||"0"}),t=await fetch(window.ajaxurl,{method:"POST",body:e.toString(),credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}});if(!t.ok)throw new Error;const a=await t.json();if(console.log(a),!a.ok)throw new Error(a.msg);d([...p,{key:"_vipps_shareable_links",value:{product_id:s,variation_id:_,key:a.key,url:a.url,variant:a.variant},id:null}])}catch(e){e instanceof Error&&alert((0,o.__)("Error creating shareable link.","woo-vipps")+e.message)}finally{h(!1)}}},y&&(0,t.createElement)(i.Spinner,null),(0,o.__)("Create shareable link","woo-vipps"))),(0,t.createElement)(n.Table,{headers:[{key:"variant",label:(0,o.__)("Variation","woo-vipps"),visible:l.length>0},{key:"link",label:(0,o.__)("Link","woo-vipps")},{key:"actions",label:(0,o.__)("Actions","woo-vipps")}],rows:m.map((e=>[{key:"variant",display:e.value.variant},{key:"link",display:(0,t.createElement)(i.Button,{href:e.value.url,variant:"link",target:"_blank"},e.value.url)},{key:"actions",display:(0,t.createElement)("div",null,(0,t.createElement)(i.Button,{disabled:null!==v,onClick:()=>async function(e){if(w(e),navigator.clipboard)navigator.clipboard.writeText(e);else{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}await new Promise((e=>setTimeout(e,2500))),w(null)}(e.value.url)},v===e.value.url?(0,o.__)("Copied!","woo-vipps"):(0,o.__)("Copy","woo-vipps")),(0,t.createElement)(i.Button,{onClick:()=>function(e){const t=p.filter((t=>t.value.key!==e));d(t)}(e.value.key)},(0,o.__)("Delete","woo-vipps")))}]))})),(0,t.createElement)("p",{dangerouslySetInnerHTML:{__html:r.message}}))}}})})();