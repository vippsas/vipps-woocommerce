(()=>{"use strict";var o={n:t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},d:(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o:(o,t)=>Object.prototype.hasOwnProperty.call(o,t)};const t=window.wp.blocks,e=window.React,n=window.wp.i18n,s=window.wp.blockEditor,i=window.wp.components,r=window.wp.primitives,l=(0,e.createElement)(r.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(r.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})),p=window.wp.apiFetch;var c=o.n(p);const a=window.ReactJSXRuntime;function u({attributes:o,setAttributes:t}){const[s,r]=(0,e.useState)(""),[l,p]=(0,e.useState)([]),[u,d]=(0,e.useState)(!1);return(0,e.useEffect)((()=>{if(s.length<3)return void p([]);const o=setTimeout((async()=>{d(!0);try{const o=(await c()({path:`/wc/store/products?search=${encodeURIComponent(s)}&per_page=10`})).map((o=>({label:o.name,value:o.id.toString()})));p(o)}catch(o){console.error("Error fetching products:",o),p([])}finally{d(!1)}}),300);return()=>clearTimeout(o)}),[s]),(0,a.jsx)(i.ComboboxControl,{label:(0,n.__)("Select Product","woo-vipps"),value:o.productId?o.productId.toString():"",onChange:o=>{const e=parseInt(null!=o?o:"");if(isNaN(e))return;const n=l.find((t=>t.value===o));n&&t({productId:e.toString(),productName:n.label})},onFilterValueChange:r,options:l,help:u?(0,n.__)("Searching...","woo-vipps"):(0,n.__)("Type at least 3 characters to search","woo-vipps")})}const d=JSON.parse('{"UU":"woo-vipps/buy-now"}');(0,t.registerBlockType)(d.UU,{edit:function({context:o,attributes:t,setAttributes:r}){var p,c;o.query&&r({hasProductContext:!0});const d=null!==(c=(null!==(p=vippsBuyNowBlockConfig.logos[t.language])&&void 0!==p?p:vippsBuyNowBlockConfig.logos.en)[t.variant])&&void 0!==c?c:"default";console.log(t),console.log(!!t.hasProductContext),console.log(!!t.productId);const w=!t.hasProductContext,[v,g]=(0,e.useState)(!(t.hasProductContext||t.productId));return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{...(0,s.useBlockProps)({className:"wp-block-button wc-block-components-product-button wc-block-button-vipps"}),children:v?(0,a.jsx)(u,{attributes:t,setAttributes:r}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("a",{className:"single-product button vipps-buy-now wp-block-button__link",title:vippsBuyNowBlockConfig.BuyNowWithVipps,children:(0,a.jsx)("img",{className:"inline vipps-logo-negative",src:d,alt:vippsBuyNowBlockConfig.BuyNowWithVipps})}),w&&(0,a.jsx)(s.BlockControls,{children:(0,a.jsx)(i.ToolbarGroup,{children:(0,a.jsx)(i.ToolbarButton,{icon:l,label:(0,n.__)("Edit product ID","woo-vipps"),onClick:()=>g(!0)})})})]})}),(0,a.jsxs)(s.InspectorControls,{children:[(0,a.jsx)(i.TextControl,{label:(0,n.__)("Product id","woo-vipps"),help:(0,n.__)("Enter the post id of the product this button should buy","woo-vipps"),value:t.productId,onChange:o=>r({productId:o}),placeholder:(0,n.__)("Product post ID","woo-vipps")}),(0,a.jsxs)(i.PanelBody,{children:[(0,a.jsx)(i.SelectControl,{onChange:o=>r({variant:o}),label:(0,n.__)("Variant","woo-vipps"),value:t.variant,options:vippsBuyNowBlockConfig.variants,help:(0,n.__)("Choose the button variant with the perfect fit for your site","woo-vipps")}),(0,a.jsx)(i.SelectControl,{onChange:o=>r({language:o}),label:(0,n.__)("Language","woo-vipps"),value:t.language,options:vippsBuyNowBlockConfig.languages,help:(0,n.__)("Choose language","woo-vipps")})]})]})]})},title:vippsBuyNowBlockConfig.vippsbuynowbutton,description:vippsBuyNowBlockConfig.vippsbuynowdescription,icon:(0,a.jsx)("img",{className:"block-editor-block-icon has-colors vipps-smile vipps-component-cion",src:vippsBuyNowBlockConfig.vippssmileurl})})})();