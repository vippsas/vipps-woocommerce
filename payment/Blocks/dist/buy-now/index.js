(()=>{"use strict";var o={n:t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},d:(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o:(o,t)=>Object.prototype.hasOwnProperty.call(o,t)};const t=window.wp.blocks,e=window.React,n=window.wp.i18n,s=window.wp.blockEditor,i=window.wp.components,r=window.wp.primitives,c=(0,e.createElement)(r.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(r.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})),l=window.wp.apiFetch;var a=o.n(l);const p=window.ReactJSXRuntime;function u({attributes:o,setAttributes:t,hideCallback:s}){const[r,c]=(0,e.useState)(o.productName),[l,u]=(0,e.useState)([]),[d,w]=(0,e.useState)(!1);console.log("LP attributes: ",o),console.log("LP searchTerm: ",r),(0,e.useEffect)((()=>{if(r.length<3)return void u([]);const o=setTimeout((async()=>{w(!0);try{const o=(await a()({path:`/wc/store/products?search=${encodeURIComponent(r)}&per_page=10`})).map((o=>({label:o.name,value:o.id.toString()})));u(o)}catch(o){console.error("Error fetching products:",o),u([])}finally{w(!1)}}),300);return()=>clearTimeout(o)}),[r]);const v=()=>{t({productId:void 0,productName:void 0})};return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(i.ComboboxControl,{label:(0,n.__)("Select Product","woo-vipps"),isLoading:d,value:o.productId?o.productId.toString():"",onChange:o=>{const e=parseInt(null!=o?o:"");if(isNaN(e))return void v();const n=l.find((t=>t.value===o));if(!n)return void v();const s=n.label;console.log(`setting the selected value, id=${e}, name=${s}`),c(s),t({productId:e,productName:s})},onFilterValueChange:c,options:l,help:(0,n.__)("Type at least 3 characters to search products","woo-vipps")}),(0,p.jsx)(i.Button,{variant:"primary",onClick:()=>{o.productId&&o.productId&&s()},children:(0,n.__)("Confirm","woo-vipps")})]})}const d=vippsBuyNowBlockConfig;function w(){return(0,p.jsx)("img",{className:"block-editor-block-icon has-colors vipps-smile vipps-component-cion",src:d.vippssmileurl})}const v=JSON.parse('{"UU":"woo-vipps/buy-now"}');(0,t.registerBlockType)(v.UU,{edit:function({context:o,attributes:t,setAttributes:r}){var l,a;o.query&&r({hasProductContext:!0});const v=null!==(a=(null!==(l=d.logos[t.language])&&void 0!==l?l:d.logos.en)[t.variant])&&void 0!==a?a:"default";console.log(t),console.log(!!t.hasProductContext),console.log(!!t.productId);const h=!t.hasProductContext,[b,g]=(0,e.useState)(!(t.hasProductContext||t.productId));return console.log("LP showProductSelection: ",b),(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{...(0,s.useBlockProps)({className:"wp-block-button wc-block-components-product-button wc-block-button-vipps"}),children:b?(0,p.jsxs)("div",{className:"vipps-buy-now-block-edit-container",children:[(0,p.jsxs)("div",{className:"vipps-buy-now-block-edit-header",children:[(0,p.jsx)(w,{}),d.vippsbuynowbutton]}),(0,p.jsx)(u,{attributes:t,setAttributes:r,hideCallback:()=>g(!1)})]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("a",{className:"single-product button vipps-buy-now wp-block-button__link",title:d.BuyNowWithVipps,children:(0,p.jsx)("img",{className:"inline vipps-logo-negative",src:v,alt:d.BuyNowWithVipps})}),h&&(0,p.jsx)(s.BlockControls,{children:(0,p.jsx)(i.ToolbarGroup,{children:(0,p.jsx)(i.ToolbarButton,{icon:c,label:(0,n.__)("Edit product","woo-vipps"),onClick:()=>g(!0)})})})]})}),(0,p.jsx)(s.InspectorControls,{children:(0,p.jsxs)(i.PanelBody,{children:[(0,p.jsx)(i.SelectControl,{onChange:o=>r({variant:o}),label:(0,n.__)("Variant","woo-vipps"),value:t.variant,options:d.variants,help:(0,n.__)("Choose the button variant with the perfect fit for your site","woo-vipps")}),(0,p.jsx)(i.SelectControl,{onChange:o=>r({language:o}),label:(0,n.__)("Language","woo-vipps"),value:t.language,options:d.languages,help:(0,n.__)("Choose language","woo-vipps")})]})})]})},title:d.vippsbuynowbutton,description:d.vippsbuynowdescription,icon:(0,p.jsx)(w,{})})})();