(()=>{"use strict";var o={n:t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},d:(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o:(o,t)=>Object.prototype.hasOwnProperty.call(o,t)};const t=window.wp.blocks,e=window.React,n=window.wp.i18n,s=window.wp.blockEditor,i=window.wp.components,r=window.wp.primitives,l=(0,e.createElement)(r.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(r.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})),a=window.wp.apiFetch;var c=o.n(a);const p=window.ReactJSXRuntime;function u({attributes:o,setAttributes:t}){const[s,r]=(0,e.useState)(""),[l,a]=(0,e.useState)([]),[u,d]=(0,e.useState)(!1);return(0,e.useEffect)((()=>{if(s.length<3)return void a([]);const o=setTimeout((async()=>{d(!0);try{const o=(await c()({path:`/wc/store/products?search=${encodeURIComponent(s)}&per_page=10`})).map((o=>({label:o.name,value:o.id.toString()})));console.log("LP productOptions: ",o),a(o)}catch(o){console.error("Error fetching products:",o),a([])}finally{d(!1)}}),300);return()=>clearTimeout(o)}),[s]),(0,p.jsx)(i.ComboboxControl,{label:(0,n.__)("Select Product","woo-vipps"),value:o.productId?o.productId.toString():"",onChange:o=>{const e=parseInt(null!=o?o:"");if(isNaN(e))return;const n=l.find((t=>t.value===o));n&&t({productId:e.toString(),productName:n.label})},onFilterValueChange:r,options:l,help:u?(0,n.__)("Searching...","woo-vipps"):(0,n.__)("Type at least 3 characters to search","woo-vipps")})}const d=window.vippsBuyNowBlockConfig;function w(){return(0,p.jsx)("img",{className:"block-editor-block-icon has-colors vipps-smile vipps-component-cion",src:d.vippssmileurl})}const h=JSON.parse('{"UU":"woo-vipps/buy-now"}');(0,t.registerBlockType)(h.UU,{edit:function({context:o,attributes:t,setAttributes:r}){var a,c;o.query&&r({hasProductContext:!0});const h=null!==(c=(null!==(a=d.logos[t.language])&&void 0!==a?a:d.logos.en)[t.variant])&&void 0!==c?c:"default";console.log(t),console.log(!!t.hasProductContext),console.log(!!t.productId);const v=!t.hasProductContext,[g,b]=(0,e.useState)(!(t.hasProductContext||t.productId));return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{...(0,s.useBlockProps)({className:"wp-block-button wc-block-components-product-button wc-block-button-vipps"}),children:g?(0,p.jsxs)("div",{children:[(0,p.jsx)(w,{}),(0,p.jsx)(u,{attributes:t,setAttributes:r})]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("a",{className:"single-product button vipps-buy-now wp-block-button__link",title:d.BuyNowWithVipps,children:(0,p.jsx)("img",{className:"inline vipps-logo-negative",src:h,alt:d.BuyNowWithVipps})}),v&&(0,p.jsx)(s.BlockControls,{children:(0,p.jsx)(i.ToolbarGroup,{children:(0,p.jsx)(i.ToolbarButton,{icon:l,label:(0,n.__)("Edit product ID","woo-vipps"),onClick:()=>b(!0)})})})]})}),(0,p.jsxs)(s.InspectorControls,{children:[(0,p.jsx)(i.TextControl,{label:(0,n.__)("Product id","woo-vipps"),help:(0,n.__)("Enter the post id of the product this button should buy","woo-vipps"),value:t.productId,onChange:o=>r({productId:o}),placeholder:(0,n.__)("Product post ID","woo-vipps")}),(0,p.jsxs)(i.PanelBody,{children:[(0,p.jsx)(i.SelectControl,{onChange:o=>r({variant:o}),label:(0,n.__)("Variant","woo-vipps"),value:t.variant,options:d.variants,help:(0,n.__)("Choose the button variant with the perfect fit for your site","woo-vipps")}),(0,p.jsx)(i.SelectControl,{onChange:o=>r({language:o}),label:(0,n.__)("Language","woo-vipps"),value:t.language,options:d.languages,help:(0,n.__)("Choose language","woo-vipps")})]})]})]})},title:d.vippsbuynowbutton,description:d.vippsbuynowdescription,icon:(0,p.jsx)(w,{})})})();