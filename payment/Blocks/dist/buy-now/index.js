(()=>{"use strict";var o={n:t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},d:(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o:(o,t)=>Object.prototype.hasOwnProperty.call(o,t)};const t=window.wp.blocks,e=window.wp.i18n,n=window.wp.blockEditor,s=window.wp.components,i=window.React,r=window.wp.primitives,c=(0,i.createElement)(r.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,i.createElement)(r.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})),l=window.wp.apiFetch;var a=o.n(l);const p=window.ReactJSXRuntime;function u({attributes:o,setAttributes:t}){const[n,r]=(0,i.useState)(o.productName),[c,l]=(0,i.useState)([]),[u,d]=(0,i.useState)(!1);console.log("LP attributes: ",o),console.log("LP searchTerm: ",n),(0,i.useEffect)((()=>{if(n.length<3)return void l([]);const o=setTimeout((async()=>{d(!0);try{const o=(await a()({path:`/wc/store/products?search=${encodeURIComponent(n)}&per_page=10`})).map((o=>({label:o.name,value:o.id.toString()})));l(o)}catch(o){console.error("Error fetching products:",o),l([])}finally{d(!1)}}),300);return()=>clearTimeout(o)}),[n]);const w=()=>{t({productId:void 0,productName:void 0})};return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(s.ComboboxControl,{label:(0,e.__)("Select Product","woo-vipps"),isLoading:u,value:n,onChange:o=>{const e=parseInt(null!=o?o:"");if(isNaN(e))return void w();const n=c.find((t=>t.value===o));n?t({productId:e.toString(),productName:n.label}):w()},onFilterValueChange:r,options:c,help:(0,e.__)("Type at least 3 characters to search products","woo-vipps")}),(0,p.jsx)(s.Button,{variant:"primary",onClick:()=>{t({showProductSelection:!1})},children:(0,e.__)("Confirm","woo-vipps")})]})}const d=vippsBuyNowBlockConfig;function w(){return(0,p.jsx)("img",{className:"block-editor-block-icon has-colors vipps-smile vipps-component-cion",src:d.vippssmileurl})}const h=JSON.parse('{"UU":"woo-vipps/buy-now"}');(0,t.registerBlockType)(h.UU,{edit:function({context:o,attributes:t,setAttributes:i}){var r,l;o.query&&i({hasProductContext:!0});const a=null!==(l=(null!==(r=d.logos[t.language])&&void 0!==r?r:d.logos.en)[t.variant])&&void 0!==l?l:"default";console.log(t),console.log(!!t.hasProductContext),console.log(!!t.productId);const h=!t.hasProductContext;return i({showProductSelection:!(t.hasProductContext||t.productId)}),console.log("LP showProductSelection: ",t.showProductSelection),(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{...(0,n.useBlockProps)({className:"wp-block-button wc-block-components-product-button wc-block-button-vipps"}),children:t.showProductSelection?(0,p.jsxs)("div",{className:"vipps-buy-now-block-edit-container",children:[(0,p.jsxs)("div",{className:"vipps-buy-now-block-edit-header",children:[(0,p.jsx)(w,{}),d.vippsbuynowbutton]}),(0,p.jsx)(u,{attributes:t,setAttributes:i})]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("a",{className:"single-product button vipps-buy-now wp-block-button__link",title:d.BuyNowWithVipps,children:(0,p.jsx)("img",{className:"inline vipps-logo-negative",src:a,alt:d.BuyNowWithVipps})}),h&&(0,p.jsx)(n.BlockControls,{children:(0,p.jsx)(s.ToolbarGroup,{children:(0,p.jsx)(s.ToolbarButton,{icon:c,label:(0,e.__)("Edit product","woo-vipps"),onClick:()=>i({showProductSelection:!0})})})})]})}),(0,p.jsx)(n.InspectorControls,{children:(0,p.jsxs)(s.PanelBody,{children:[(0,p.jsx)(s.SelectControl,{onChange:o=>i({variant:o}),label:(0,e.__)("Variant","woo-vipps"),value:t.variant,options:d.variants,help:(0,e.__)("Choose the button variant with the perfect fit for your site","woo-vipps")}),(0,p.jsx)(s.SelectControl,{onChange:o=>i({language:o}),label:(0,e.__)("Language","woo-vipps"),value:t.language,options:d.languages,help:(0,e.__)("Choose language","woo-vipps")})]})})]})},title:d.vippsbuynowbutton,description:d.vippsbuynowdescription,icon:(0,p.jsx)(w,{})})})();