(()=>{"use strict";var t={n:o=>{var e=o&&o.__esModule?()=>o.default:()=>o;return t.d(e,{a:e}),e},d:(o,e)=>{for(var n in e)t.o(e,n)&&!t.o(o,n)&&Object.defineProperty(o,n,{enumerable:!0,get:e[n]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o)};const o=window.wp.blocks,e=window.React,n=window.wp.i18n,s=window.wp.blockEditor,r=window.wp.components,i=window.wp.primitives,c=(0,e.createElement)(i.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(i.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})),a=vippsBuyNowBlockConfig,l=window.wp.apiFetch;var p=t.n(l);const u=window.wp.url,d=window.ReactJSXRuntime;function w({attributes:t,setAttributes:o,hideCallback:s}){const[i,c]=(0,e.useState)(""),[l,w]=(0,e.useState)(!1),[v,m]=(0,e.useState)([]),[b,h]=(0,e.useState)(!1);(0,e.useEffect)((()=>{if(!l)return void w(!0);if(!i.trim())return void m([]);const t=t=>{console.error("Error fetching products:",t),m([])},o=`${a.vippsresturl}/express-products`,e={search:i,per_page:"10",action:"woo_vipps_express_checkout_products",orderby:"title",order:"desc"},n=setTimeout((async()=>{h(!0),p()({path:(0,u.addQueryArgs)(o,e),method:"GET"}).then((t=>{const o=t.map((t=>({label:t.name,value:t.id.toString()})));m(o)})).catch(t).finally((()=>h(!1)))}),300);return()=>clearTimeout(n)}),[i]);const g=()=>{o({productId:"",productName:"",productParentId:""})};return(0,d.jsxs)(d.Fragment,{children:[t.productName&&(0,d.jsxs)("div",{style:{marginBottom:"8px",fontSize:"14px",color:"#666"},children:[(0,n.__)("Selected product","woo-vipps")+": "," ",(0,d.jsx)("strong",{children:t.productName})]}),(0,d.jsx)(r.ComboboxControl,{className:"vipps-buy-now-button-product-search",__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:(0,n.__)("Search Product","woo-vipps"),isLoading:b,value:t.productId,onChange:t=>{const e=parseInt(null!=t?t:"");if(isNaN(e))return void g();const n=v.find((o=>o.value===t));if(!n)return void g();const s=n.label;c(""),o({productId:e.toString(),productName:s})},onFilterValueChange:c,options:v}),(0,d.jsx)(r.Button,{variant:"primary",onClick:()=>{t.productId&&t.productId&&s()},children:(0,n.__)("Confirm","woo-vipps")})]})}function v(){return(0,d.jsx)("img",{className:"block-editor-block-icon has-colors vipps-smile vipps-component-cion",src:a.vippssmileurl})}const m=window.wp.data,b=new Set(["woocommerce/cart","woocommerce/cart-contents","woocommerce/mini-cart","woocommerce/mini-cart-contents"]),h=JSON.parse('{"UU":"woo-vipps/buy-now"}');(0,o.registerBlockType)(h.UU,{edit:function({context:t,attributes:o,setAttributes:i,clientId:l}){var p,u;const h=(t=>(0,m.useSelect)((o=>{const{getBlockParents:e,getBlockName:n}=o(s.store);return e(t).some((t=>b.has(n(t))))}),[t]))(l),g="product"===t.postType;(0,e.useEffect)((()=>{o.isCartMode!==h&&i({isCartMode:h})}),[h]),(0,e.useEffect)((()=>{o.hasProductContext!==g&&i({hasProductContext:g})}),[g]);const x=null!==(u=(null!==(p=a.logos[o.language])&&void 0!==p?p:a.logos.en)[o.variant])&&void 0!==u?u:"default",[_,f]=(0,e.useState)(!h&&!g&&!o.productId),j=!h&&!o.hasProductContext;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{...(0,s.useBlockProps)({className:"wp-block-button wc-block-components-product-button wc-block-button-vipps"}),children:_?(0,d.jsxs)("div",{className:"vipps-buy-now-block-edit-container",children:[(0,d.jsxs)("div",{className:"vipps-buy-now-block-edit-header",children:[(0,d.jsx)(v,{}),a.vippsbuynowbutton]}),(0,d.jsx)(w,{attributes:o,setAttributes:i,hideCallback:()=>f(!1)})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("a",{className:"single-product button vipps-buy-now wp-block-button__link",title:a.BuyNowWithVipps,children:(0,d.jsx)("img",{className:"inline vipps-logo-negative",src:x,alt:a.BuyNowWithVipps})}),j&&(0,d.jsx)(s.BlockControls,{children:(0,d.jsx)(r.ToolbarGroup,{children:(0,d.jsx)(r.ToolbarButton,{icon:c,label:(0,n.__)("Edit selected product","woo-vipps"),onClick:()=>f(!0)})})})]})}),!h&&(0,d.jsx)(s.InspectorControls,{children:(0,d.jsxs)(r.PanelBody,{children:[(0,d.jsx)(r.SelectControl,{onChange:t=>i({variant:t}),label:(0,n.__)("Variant","woo-vipps"),value:o.variant,options:a.variants,help:(0,n.__)("Choose the button variant with the perfect fit for your site","woo-vipps")}),(0,d.jsx)(r.SelectControl,{onChange:t=>i({language:t}),label:(0,n.__)("Language","woo-vipps"),value:o.language,options:a.languages,help:(0,n.__)("Choose language","woo-vipps")})]})})]})},title:a.vippsbuynowbutton,description:a.vippsbuynowdescription,icon:(0,d.jsx)(v,{})})})();