(()=>{"use strict";const t=window.wp.blocks,o=window.React,e=window.wp.i18n,n=window.wp.blockEditor,s=window.wp.components,i=window.wp.primitives,r=(0,o.createElement)(i.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,o.createElement)(i.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})),a=vippsBuyNowBlockConfig,c=window.ReactJSXRuntime;function l({attributes:t,setAttributes:n,hideCallback:i}){const[r,l]=(0,o.useState)(""),[p,u]=(0,o.useState)(!1),[d,v]=(0,o.useState)([]),[w,b]=(0,o.useState)(!1);(0,o.useEffect)((()=>{if(!p)return void u(!0);if(!r.trim())return void v([]);const t=t=>{console.error("Error fetching products:",t),v([])},o=new URLSearchParams({search:r,per_page:"10",action:"woo_vipps_express_checkout_products",orderby:"title",order:"desc",_ajax_nonce:a.vippsajaxnonce}).toString(),e=setTimeout((async()=>{b(!0),fetch(`${a.vippsajaxurl}?${o}`,{method:"GET"}).then((t=>t.json())).then((o=>{var e;if(!o.success||!Number(o.data.ok))return void t(`Result was not ok: ${JSON.stringify(o)}`);const n=(null!==(e=o.data.products)&&void 0!==e?e:[]).map((t=>({label:t.name,value:t.id.toString(),parentId:t.is_variation?t.parent?.toString():void 0})));v(n)})).catch(t).finally((()=>b(!1)))}),300);return()=>clearTimeout(e)}),[r]);const h=()=>{n({productId:"",productName:""})};return(0,c.jsxs)(c.Fragment,{children:[t.productName&&(0,c.jsxs)("div",{style:{marginBottom:"8px",fontSize:"14px",color:"#666"},children:[(0,e.__)("Selected product","woo-vipps")+": "," ",(0,c.jsx)("strong",{children:t.productName})]}),(0,c.jsx)(s.ComboboxControl,{className:"vipps-buy-now-button-product-search",__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:(0,e.__)("Search Product","woo-vipps"),isLoading:w,value:t.productId,onChange:t=>{const o=parseInt(null!=t?t:"");if(isNaN(o))return void h();const e=d.find((o=>o.value===t));if(!e)return void h();const s=e.label;l(""),n({productId:o.toString(),productName:s,productParentId:e.parentId})},onFilterValueChange:l,options:d}),(0,c.jsx)(s.Button,{variant:"primary",onClick:()=>{t.productId&&t.productId&&i()},children:(0,e.__)("Confirm","woo-vipps")})]})}function p(){return(0,c.jsx)("img",{className:"block-editor-block-icon has-colors vipps-smile vipps-component-cion",src:a.vippssmileurl})}const u=JSON.parse('{"UU":"woo-vipps/buy-now"}');(0,t.registerBlockType)(u.UU,{edit:function({context:t,attributes:i,setAttributes:u}){var d,v;const w=!!t.query;w&&u({hasProductContext:!0});const b=null!==(v=(null!==(d=a.logos[i.language])&&void 0!==d?d:a.logos.en)[i.variant])&&void 0!==v?v:"default",h=!i.hasProductContext,[m,g]=(0,o.useState)(!(w||i.productId));return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{...(0,n.useBlockProps)({className:"wp-block-button wc-block-components-product-button wc-block-button-vipps"}),children:m?(0,c.jsxs)("div",{className:"vipps-buy-now-block-edit-container",children:[(0,c.jsxs)("div",{className:"vipps-buy-now-block-edit-header",children:[(0,c.jsx)(p,{}),a.vippsbuynowbutton]}),(0,c.jsx)(l,{attributes:i,setAttributes:u,hideCallback:()=>g(!1)})]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("a",{className:"single-product button vipps-buy-now wp-block-button__link",title:a.BuyNowWithVipps,children:(0,c.jsx)("img",{className:"inline vipps-logo-negative",src:b,alt:a.BuyNowWithVipps})}),h&&(0,c.jsx)(n.BlockControls,{children:(0,c.jsx)(s.ToolbarGroup,{children:(0,c.jsx)(s.ToolbarButton,{icon:r,label:(0,e.__)("Edit selected product","woo-vipps"),onClick:()=>g(!0)})})})]})}),(0,c.jsx)(n.InspectorControls,{children:(0,c.jsxs)(s.PanelBody,{children:[(0,c.jsx)(s.SelectControl,{onChange:t=>u({variant:t}),label:(0,e.__)("Variant","woo-vipps"),value:i.variant,options:a.variants,help:(0,e.__)("Choose the button variant with the perfect fit for your site","woo-vipps")}),(0,c.jsx)(s.SelectControl,{onChange:t=>u({language:t}),label:(0,e.__)("Language","woo-vipps"),value:i.language,options:a.languages,help:(0,e.__)("Choose language","woo-vipps")})]})})]})},title:a.vippsbuynowbutton,description:a.vippsbuynowdescription,icon:(0,c.jsx)(p,{})})})();