(()=>{"use strict";var t={n:o=>{var e=o&&o.__esModule?()=>o.default:()=>o;return t.d(e,{a:e}),e},d:(o,e)=>{for(var n in e)t.o(e,n)&&!t.o(o,n)&&Object.defineProperty(o,n,{enumerable:!0,get:e[n]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o)};const o=window.wp.blocks,e=window.React,n=window.wp.i18n,s=window.wp.blockEditor,r=window.wp.components,i=window.wp.primitives,a=(0,e.createElement)(i.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(i.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})),c=vippsBuyNowBlockConfig,p=window.wp.apiFetch;var l=t.n(p);const u=window.wp.url,d=window.ReactJSXRuntime;function v({attributes:t,setAttributes:o,hideCallback:s}){const[i,a]=(0,e.useState)(""),[p,v]=(0,e.useState)(!1),[w,b]=(0,e.useState)([]),[h,g]=(0,e.useState)(!1);(0,e.useEffect)((()=>{if(!p)return void v(!0);if(!i.trim())return void b([]);const t=t=>{console.error("Error fetching products:",t),b([])},o=`${c.vippsresturl}/express-products`,e={search:i,per_page:"10",action:"woo_vipps_express_checkout_products",orderby:"title",order:"desc"},n=setTimeout((async()=>{g(!0),l()({path:(0,u.addQueryArgs)(o,e),method:"GET"}).then((t=>{const o=t.map((t=>({label:t.name,value:t.id.toString(),parentId:t.is_variation?t.parent?.toString():void 0})));b(o)})).catch(t).finally((()=>g(!1)))}),300);return()=>clearTimeout(n)}),[i]);const m=()=>{o({productId:"",productName:"",productParentId:""})};return(0,d.jsxs)(d.Fragment,{children:[t.productName&&(0,d.jsxs)("div",{style:{marginBottom:"8px",fontSize:"14px",color:"#666"},children:[(0,n.__)("Selected product","woo-vipps")+": "," ",(0,d.jsx)("strong",{children:t.productName})]}),(0,d.jsx)(r.ComboboxControl,{className:"vipps-buy-now-button-product-search",__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:(0,n.__)("Search Product","woo-vipps"),isLoading:h,value:t.productId,onChange:t=>{const e=parseInt(null!=t?t:"");if(isNaN(e))return void m();const n=w.find((o=>o.value===t));if(!n)return void m();const s=n.label;a(""),o({productId:e.toString(),productName:s,productParentId:n.parentId})},onFilterValueChange:a,options:w}),(0,d.jsx)(r.Button,{variant:"primary",onClick:()=>{t.productId&&t.productId&&s()},children:(0,n.__)("Confirm","woo-vipps")})]})}function w(){return(0,d.jsx)("img",{className:"block-editor-block-icon has-colors vipps-smile vipps-component-cion",src:c.vippssmileurl})}const b=JSON.parse('{"UU":"woo-vipps/buy-now"}');(0,o.registerBlockType)(b.UU,{edit:function({context:t,attributes:o,setAttributes:i}){var p,l;const u=!!t.query;u&&i({hasProductContext:!0});const b=null!==(l=(null!==(p=c.logos[o.language])&&void 0!==p?p:c.logos.en)[o.variant])&&void 0!==l?l:"default",h=!o.hasProductContext,[g,m]=(0,e.useState)(!(u||o.productId));return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{...(0,s.useBlockProps)({className:"wp-block-button wc-block-components-product-button wc-block-button-vipps"}),children:g?(0,d.jsxs)("div",{className:"vipps-buy-now-block-edit-container",children:[(0,d.jsxs)("div",{className:"vipps-buy-now-block-edit-header",children:[(0,d.jsx)(w,{}),c.vippsbuynowbutton]}),(0,d.jsx)(v,{attributes:o,setAttributes:i,hideCallback:()=>m(!1)})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("a",{className:"single-product button vipps-buy-now wp-block-button__link",title:c.BuyNowWithVipps,children:(0,d.jsx)("img",{className:"inline vipps-logo-negative",src:b,alt:c.BuyNowWithVipps})}),h&&(0,d.jsx)(s.BlockControls,{children:(0,d.jsx)(r.ToolbarGroup,{children:(0,d.jsx)(r.ToolbarButton,{icon:a,label:(0,n.__)("Edit selected product","woo-vipps"),onClick:()=>m(!0)})})})]})}),(0,d.jsx)(s.InspectorControls,{children:(0,d.jsxs)(r.PanelBody,{children:[(0,d.jsx)(r.SelectControl,{onChange:t=>i({variant:t}),label:(0,n.__)("Variant","woo-vipps"),value:o.variant,options:c.variants,help:(0,n.__)("Choose the button variant with the perfect fit for your site","woo-vipps")}),(0,d.jsx)(r.SelectControl,{onChange:t=>i({language:t}),label:(0,n.__)("Language","woo-vipps"),value:o.language,options:c.languages,help:(0,n.__)("Choose language","woo-vipps")})]})})]})},title:c.vippsbuynowbutton,description:c.vippsbuynowdescription,icon:(0,d.jsx)(w,{})})})();