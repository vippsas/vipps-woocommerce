(()=>{"use strict";const o=window.wp.blocks,t=window.React,e=window.wp.i18n,n=window.wp.blockEditor,s=window.wp.components,i=window.wp.primitives,r=(0,t.createElement)(i.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,t.createElement)(i.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})),a=vippsBuyNowBlockConfig,c=window.ReactJSXRuntime;function l({attributes:o,setAttributes:n,hideCallback:i}){console.log("LP attributes: ",o);const[r,l]=(0,t.useState)("");console.log("LP searchTerm: ",r);const[p,u]=(0,t.useState)(!1),[d,v]=(0,t.useState)([]),[h,w]=(0,t.useState)(!1);(0,t.useEffect)((()=>{if(!p)return void u(!0);if(r.length<3)return void v([]);const o=o=>{console.error("Error fetching products:",o),v([])},t=new URLSearchParams({search:r,per_page:"10",action:"woo_vipps_express_checkout_products",orderby:"title",order:"desc",_ajax_nonce:a.vippsajaxnonce}).toString(),e=setTimeout((async()=>{w(!0),fetch(`${a.vippsajaxurl}?${t}`,{method:"GET"}).then((o=>o.json())).then((t=>{var e;if(!t.success||!Number(t.data.ok))return void o(`Result was not ok: ${JSON.stringify(t)}`);const n=(null!==(e=t.data.products)&&void 0!==e?e:[]).map((o=>({label:o.name,value:o.id.toString()})));v(n)})).catch(o).finally((()=>w(!1)))}),300);return()=>clearTimeout(e)}),[r]);const b=()=>{n({productId:"",productName:""})};return(0,c.jsxs)(c.Fragment,{children:[o.productName&&(0,c.jsxs)("div",{style:{marginBottom:"8px",fontSize:"14px",color:"#666"},children:[(0,e.__)("Selected product","woo-vipps")+": "," ",(0,c.jsx)("strong",{children:o.productName})]}),(0,c.jsx)(s.ComboboxControl,{className:"vipps-buy-now-button-product-search",__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:(0,e.__)("Search Product","woo-vipps"),isLoading:h,value:o.productId,onChange:o=>{const t=parseInt(null!=o?o:"");if(isNaN(t))return void b();const e=d.find((t=>t.value===o));if(console.log("LP selectedOption: ",e),!e)return void b();const s=e.label;l(""),n({productId:t.toString(),productName:s})},onFilterValueChange:l,options:d,help:(0,e.__)("Type at least %1 characters to search products","woo-vipps").replace("%1",3..toString())}),(0,c.jsx)(s.Button,{variant:"primary",onClick:()=>{o.productId&&o.productId&&i()},children:(0,e.__)("Confirm","woo-vipps")})]})}function p(){return(0,c.jsx)("img",{className:"block-editor-block-icon has-colors vipps-smile vipps-component-cion",src:a.vippssmileurl})}const u=JSON.parse('{"UU":"woo-vipps/buy-now"}');(0,o.registerBlockType)(u.UU,{edit:function({context:o,attributes:i,setAttributes:u}){var d,v;const h=!!o.query;h&&u({hasProductContext:!0});const w=null!==(v=(null!==(d=a.logos[i.language])&&void 0!==d?d:a.logos.en)[i.variant])&&void 0!==v?v:"default",b=!i.hasProductContext,[g,m]=(0,t.useState)(!(h||i.productId));return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{...(0,n.useBlockProps)({className:"wp-block-button wc-block-components-product-button wc-block-button-vipps"}),children:g?(0,c.jsxs)("div",{className:"vipps-buy-now-block-edit-container",children:[(0,c.jsxs)("div",{className:"vipps-buy-now-block-edit-header",children:[(0,c.jsx)(p,{}),a.vippsbuynowbutton]}),(0,c.jsx)(l,{attributes:i,setAttributes:u,hideCallback:()=>m(!1)})]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("a",{className:"single-product button vipps-buy-now wp-block-button__link",title:a.BuyNowWithVipps,children:(0,c.jsx)("img",{className:"inline vipps-logo-negative",src:w,alt:a.BuyNowWithVipps})}),b&&(0,c.jsx)(n.BlockControls,{children:(0,c.jsx)(s.ToolbarGroup,{children:(0,c.jsx)(s.ToolbarButton,{icon:r,label:(0,e.__)("Edit chosen product","woo-vipps"),onClick:()=>m(!0)})})})]})}),(0,c.jsx)(n.InspectorControls,{children:(0,c.jsxs)(s.PanelBody,{children:[(0,c.jsx)(s.SelectControl,{onChange:o=>u({variant:o}),label:(0,e.__)("Variant","woo-vipps"),value:i.variant,options:a.variants,help:(0,e.__)("Choose the button variant with the perfect fit for your site","woo-vipps")}),(0,c.jsx)(s.SelectControl,{onChange:o=>u({language:o}),label:(0,e.__)("Language","woo-vipps"),value:i.language,options:a.languages,help:(0,e.__)("Choose language","woo-vipps")})]})})]})},title:a.vippsbuynowbutton,description:a.vippsbuynowdescription,icon:(0,c.jsx)(p,{})})})();