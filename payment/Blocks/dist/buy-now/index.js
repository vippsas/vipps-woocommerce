(()=>{"use strict";var t={n:o=>{var e=o&&o.__esModule?()=>o.default:()=>o;return t.d(e,{a:e}),e},d:(o,e)=>{for(var n in e)t.o(e,n)&&!t.o(o,n)&&Object.defineProperty(o,n,{enumerable:!0,get:e[n]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o)};const o=window.wp.blocks,e=window.React,n=window.wp.i18n,s=window.wp.blockEditor,i=window.wp.components,r=window.wp.primitives,a=(0,e.createElement)(r.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(r.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})),c=vippsBuyNowBlockConfig,l=window.wp.apiFetch;var p=t.n(l);const u=window.wp.url,d=window.ReactJSXRuntime;function w({attributes:t,setAttributes:o,hideCallback:s}){const[r,a]=(0,e.useState)(""),[l,w]=(0,e.useState)(!1),[v,b]=(0,e.useState)([]),[h,m]=(0,e.useState)(!1);(0,e.useEffect)((()=>{if(!l)return void w(!0);if(!r.trim())return void b([]);const t=t=>{console.error("Error fetching products:",t),b([])},o=`${c.vippsresturl}/express-products`,e={search:r,per_page:"10",action:"woo_vipps_express_checkout_products",orderby:"title",order:"desc"},n=setTimeout((async()=>{m(!0),p()({path:(0,u.addQueryArgs)(o,e),method:"GET"}).then((t=>{const o=t.map((t=>({label:t.name,value:t.id.toString()})));b(o)})).catch(t).finally((()=>m(!1)))}),300);return()=>clearTimeout(n)}),[r]);const g=()=>{o({productId:"",productName:"",productParentId:""})};return(0,d.jsxs)(d.Fragment,{children:[t.productName&&(0,d.jsxs)("div",{style:{marginBottom:"8px",fontSize:"14px",color:"#666"},children:[(0,n.__)("Selected product","woo-vipps")+": "," ",(0,d.jsx)("strong",{children:t.productName})]}),(0,d.jsx)(i.ComboboxControl,{className:"vipps-buy-now-button-product-search",__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:(0,n.__)("Search Product","woo-vipps"),isLoading:h,value:t.productId,onChange:t=>{const e=parseInt(null!=t?t:"");if(isNaN(e))return void g();const n=v.find((o=>o.value===t));if(!n)return void g();const s=n.label;a(""),o({productId:e.toString(),productName:s})},onFilterValueChange:a,options:v}),(0,d.jsx)(i.Button,{variant:"primary",onClick:()=>{t.productId&&t.productId&&s()},children:(0,n.__)("Confirm","woo-vipps")})]})}function v(){return(0,d.jsx)("img",{className:"block-editor-block-icon has-colors vipps-smile vipps-component-cion",src:c.vippssmileurl})}const b=JSON.parse('{"UU":"woo-vipps/buy-now"}');(0,o.registerBlockType)(b.UU,{edit:function({context:t,attributes:o,setAttributes:r}){var l,p;const u="product"===t.postType;(0,e.useEffect)((()=>{o.hasProductContext!==u&&r({hasProductContext:u})}),[]);const b=(null!==(l=c.logos[o.language])&&void 0!==l?l:c.logos.en)[null!==(p=o.variant)&&void 0!==p?p:"default"],h=!o.hasProductContext,[m,g]=(0,e.useState)(!u&&!o.productId);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{...(0,s.useBlockProps)({className:"wp-block-button wc-block-components-product-button wc-block-button-vipps"}),children:m?(0,d.jsxs)("div",{className:"vipps-buy-now-block-edit-container",children:[(0,d.jsxs)("div",{className:"vipps-buy-now-block-edit-header",children:[(0,d.jsx)(v,{}),c.vippsbuynowbutton]}),(0,d.jsx)(w,{attributes:o,setAttributes:r,hideCallback:()=>g(!1)})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("a",{className:"single-product button vipps-buy-now wp-block-button__link",title:c.BuyNowWithVipps,children:(0,d.jsx)("img",{className:"inline vipps-logo-negative",src:b,alt:c.BuyNowWithVipps})}),h&&(0,d.jsx)(s.BlockControls,{children:(0,d.jsx)(i.ToolbarGroup,{children:(0,d.jsx)(i.ToolbarButton,{icon:a,label:(0,n.__)("Edit selected product","woo-vipps"),onClick:()=>g(!0)})})})]})}),(0,d.jsx)(s.InspectorControls,{children:(0,d.jsxs)(i.PanelBody,{children:[(0,d.jsx)(i.SelectControl,{onChange:t=>r({variant:t}),label:(0,n.__)("Variant","woo-vipps"),value:o.variant,options:c.variants,help:(0,n.__)("Choose the button variant with the perfect fit for your site","woo-vipps")}),(0,d.jsx)(i.SelectControl,{onChange:t=>r({language:t}),label:(0,n.__)("Language","woo-vipps"),value:o.language,options:c.languages,help:(0,n.__)("Choose language","woo-vipps")})]})})]})},title:c.vippsbuynowbutton,description:c.vippsbuynowdescription,icon:(0,d.jsx)(v,{})})})();