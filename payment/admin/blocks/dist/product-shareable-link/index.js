(()=>{"use strict";var e={20:(e,t,r)=>{var i=r(609),o=Symbol.for("react.element"),n=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,r){var i,l={},p=null,c=null;for(i in void 0!==r&&(p=""+r),void 0!==t.key&&(p=""+t.key),void 0!==t.ref&&(c=t.ref),t)n.call(t,i)&&!s.hasOwnProperty(i)&&(l[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===l[i]&&(l[i]=t[i]);return{$$typeof:o,type:e,key:p,ref:c,props:l,_owner:a.current}}t.jsx=l,t.jsxs=l},848:(e,t,r)=>{e.exports=r(20)},609:e=>{e.exports=window.React}},t={};function r(i){var o=t[i];if(void 0!==o)return o.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,r),n.exports}const i=window.wc.productEditor,o=window.wc.blockTemplates,n=window.wc.components,a=window.wp.components,s=window.wp.i18n;var l=r(609),p=r(848);const c=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"woo-vipps/product-shareable-link","version":"0.1.0","title":"Blocks","category":"widgets","icon":"flag","description":"A block that handles Vipps MobilePay shareable links for the new WooCommerce product editor.","attributes":{"message":{"type":"string","__experimentalRole":"content","source":"text","selector":"div"},"title":{"type":"string"}},"supports":{"html":false,"inserter":false},"textdomain":"woo-vipps","editorScript":"file:./index.js","editorStyle":"file:./index.css","style":"file:./index.css"}');(0,i.registerProductEditorBlockType)({metadata:c,settings:{edit:function({attributes:e}){const[t=[]]=(0,i.__experimentalUseProductEntityProp)("variations"),r=["",...t],c=t.length>0,[d]=(0,i.__experimentalUseProductEntityProp)("id"),u=(0,o.useWooBlockProps)(e),[_=[],v]=(0,i.__experimentalUseProductEntityProp)("meta_data"),[y]=(0,i.__experimentalUseProductEntityProp)("vipps_share_link_nonce"),[w]=(0,i.__experimentalUseProductEntityProp)("vipps_buy_product_url"),m=_.filter((e=>e.key.startsWith("_vipps_shareable_link_")&&void 0!==e.value)),[k,h]=(0,l.useState)(null),[b,f]=(0,l.useState)(null),[x,g]=(0,l.useState)(!1);return(0,p.jsxs)("div",{...u,children:[(0,p.jsx)("span",{children:e.title}),(0,p.jsxs)("div",{children:[(0,p.jsxs)("div",{className:"create-link-section",children:[c&&(0,p.jsx)(a.SelectControl,{className:"vipps-sharelink-variant",value:b?.toString(),onChange:e=>{var t;return f(null!==(t=parseInt(e,10))&&void 0!==t?t:null)},label:(0,s.__)("Variation","woo-vipps"),options:r.map((e=>({label:e.toString(),value:e.toString()})))}),(0,p.jsxs)(a.Button,{variant:"secondary",disabled:x,type:"button",onClick:async function(){try{g(!0);const e=new URLSearchParams({action:"vipps_generate_unused_shareable_meta_key",vipps_share_shareable_link_nonce:y,prodid:d,varid:b?.toString()||"0"}),t=await fetch(window.ajaxurl,{method:"POST",body:e.toString(),credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}});if(!t.ok)throw new Error;const r=await t.json();if(!r.ok)throw new Error(r.msg);v([..._,{key:"_vipps_shareable_link_"+r.key,value:{product_id:d,variation_id:r.variation_id,key:r.key},id:-1}])}catch(e){e instanceof Error&&alert((0,s.__)("Error creating shareable link.","woo-vipps")+e.message)}finally{g(!1)}},children:[x&&(0,p.jsx)(a.Spinner,{}),(0,s.__)("Create shareable link","woo-vipps")]})]}),(0,p.jsx)(n.Table,{headers:[{key:"variant",label:(0,s.__)("Variation","woo-vipps"),visible:c},{key:"link",label:(0,s.__)("Link","woo-vipps")},{key:"actions",label:(0,s.__)("Actions","woo-vipps"),cellClassName:"table-actions-col"}].filter((e=>!1!==e.visible)),rows:m.map((e=>{console.log("Item %j",e);let t=new URL(w);return t.searchParams.set("pr",e.value.key),e.value.url=t.toString(),[{key:"variant",display:e.value.variant,visible:c},{key:"link",display:(0,p.jsx)(a.Button,{href:e.value.url,variant:"link",target:"_blank",children:e.value.url})},{key:"actions",display:(0,p.jsxs)("div",{children:[(0,p.jsx)(a.Button,{disabled:null!==k,onClick:()=>async function(e){if(h(e),navigator.clipboard)navigator.clipboard.writeText(e);else{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}await new Promise((e=>setTimeout(e,2500))),h(null)}(e.value.url),children:k===e.value.url?(0,s.__)("Copied!","woo-vipps"):(0,s.__)("Copy","woo-vipps")}),(0,p.jsx)(a.Button,{onClick:()=>function(e){const t=_.map((t=>t.key==="_vipps_shareable_link_"+e&&t?.value?.key==e?{...t,value:void 0}:t));v(t)}(e.value.key),children:(0,s.__)("Delete","woo-vipps")})]})}].filter((e=>!1!==e.visible))}))})]}),(0,p.jsx)("p",{dangerouslySetInnerHTML:{__html:e.message}})]})}}})})();