(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,r=window.wp.element,n=window.wp.apiFetch;var c=e.n(n);const a=window.wp.i18n;var o,s;document.getElementById("vipps-mobilepay-recurring-checkout")&&(o=document.querySelector("#vipps-mobilepay-recurring-checkout"),s=(0,t.createElement)((function(){const{pendingOrderId:e,data:n}=window.VippsRecurringCheckout,[o,s]=(0,r.useState)(!!n.session),[i,u]=(0,r.useState)(n.session),[l,d]=(0,r.useState)(null),p=(0,r.useRef)(null),m=(0,r.useRef)(null);(0,r.useEffect)((()=>{o||(w(),s(!0))}),[i,o]),(0,r.useEffect)((()=>{n.redirect_url&&(window.location.href=n.redirect_url)}),[n]);const w=(0,r.useCallback)((()=>{c()({path:"/vipps-mobilepay-recurring/v1/checkout/session",method:"POST"}).then((e=>u(e)))}),[e]),f=(0,r.useCallback)((()=>{c()({path:"/vipps-mobilepay-recurring/v1/checkout/session",method:"GET"}).then((e=>d(e)))}),[]);(0,r.useEffect)((()=>{if(i.token)return p.current=setInterval(f,1e4),()=>{clearInterval(p.current)}}),[i]),(0,r.useEffect)((()=>{l&&("EXPIRED"!==l.status?l.redirect_url&&(window.location.href=l.redirect_url):clearInterval(p.current))}),[l]);const h=(0,r.useCallback)((e=>{const t=m.current.getAttribute("src"),r=new URL(t).origin;e.origin===r&&("resize"===e.data.type&&(m.current.style.height=`${e.data.frameHeight}px`),"payment_url"===e.data.type&&(window.location.href=e.data.paymentUrl))}),[m.current]);return(0,r.useEffect)((()=>{if(m.current)return window.addEventListener("message",h),()=>{window.removeEventListener("message",h)}}),[m.current,i.token]),(0,t.createElement)("form",{id:"vippsdata",className:"woocommerce-checkout"},(0,t.createElement)("div",{className:"vipps-recurring-checkout-page"},(0,t.createElement)("div",{className:"vipps-recurring-checkout-page__loading"},"EXPIRED"!==l?.status&&(0,t.createElement)(t.Fragment,null,!i.token&&(0,t.createElement)("div",{className:"vipps-recurring-checkout-page__loading__spinner"}),i.token&&(0,t.createElement)("iframe",{ref:m,src:`${i.checkoutFrontendUrl||i.src}?token=${i.token}`,frameborder:"0",width:"100%"})),"EXPIRED"===l?.status&&(0,t.createElement)("div",null,(0,a.__)("Checkout session expired. Please refresh to start a new session.","vipps-recurring-payments-gateway-for-woocommerce")))))}),null),r.createRoot?(0,r.createRoot)(o).render(s):(0,r.render)(s,o))})();